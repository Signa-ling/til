# Authentication vs Authorization

## 概要

認証と認可が毎回分からなくなるので、軽く調べて整理

### 認証

簡単に言うと本人確認処理をすること。

一般的にはサービス（サイト）毎に認証の仕組みは独自で提供しており、サービスの運営側はサービス上で利用者のアカウント情報を管理し、ユーザーは各サイトでアカウントを作成する必要がある。

なお、この方式だと運営側は利用者の個人情報管理の負担が、ユーザーはサービス毎に管理するアカウント数が増える負担が生じる。
そのため、以下のような手法に基づいた利用者の多い Web サービスが管理しているアカウント情報を利用した認証技術があり、これらを用いることで双方の負担が減らされる。

#### 認証 API

認証を行う Web アプリケーションがユーザーを認証 API に誘導する。
この API から認証結果の通知をもらうことで、ユーザーのログイン情報を扱うこと無く認証処理を行える。

問題点は以下の２つ

1. ユーザー側の問題: 対象の認証 API 側のアカウントを持っていないとこの方式で認証できない
2. Web サービス運営側の問題: API を提供するサービス毎に API の仕様が異なるため、複数の認証 API への対応に手間がかかる

#### OpenID

認証 API の問題を解決するために認証処理を標準化したプロトコルのこと。
複数企業が提供する認証サービスを同じ手順で利用することが出来る。

現在の最新仕様は OpenID Connect(OIDC) で、これは後述する OAuth 2.0 を拡張して ID Token の概念を導入していて、これによって標準化された手順での認証を実現している

### 認可

ユーザーごとの権限によってサービス内で利用できる範囲を変えること。
例えばマネージャーは他メンバーの評価を見れるけど、メンバーは自分の評価しか見れない…みたいな。

自サービス内で完結する場合は自前で提供すれば良いが、サイトを跨いだ利用を行うケースがある。（例えば、 X は外部のアプリやサイトから投稿を行うなど）
こういったケースで認可をする場合に利用できる標準化されたプロトコルとして OAuth がある。

#### OAuth

利用したいサービスをリソースと呼び、サービス提供を行うサーバーをリソースサーバー、そこのユーザーをリソースオーナー、認可を受けてリソースを利用する Web サイトなどをクライアントを呼ぶ。

例えば、ブログサイトで X への投稿を利用できるようにしたい場合は以下のようになる

1. クライアント（ブログサイト）「リソースオーナーさん！許可してください！」
2. リソースオーナー（ユーザー）「いいよ」
3. クライアント「リソースサーバーさん、許可が得られたのでトークン（リソース利用時の合言葉）をください！」
4. リソースサーバー（X の OAuth）「どうぞ（トークン発行）」
5. クライアント「トークンを使いながら投稿！」
6. リソースサーバー（X の API）「トークンが発行されてるから投稿を許可！」

OAuth 単体では認可機能のみを提供しており、認証は行わない。
そのため、基本的に認証を行う他のプロトコルと併用して利用されるが、先程述べた OIDC は認証機能と認可機能が実現できる。

## 参考

- [イラスト図解式 この一冊で全部わかるWeb技術の基本 第2版 | SBクリエイティブ](https://www.sbcr.jp/product/4815625948/)
  - P.162 ~ 165
